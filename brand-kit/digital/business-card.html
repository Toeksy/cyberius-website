<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="version" content="2025-12-19-v6" />
  <title>Codesphere - Digitaalinen käyntikortti</title>
  <style>
    :root {
      --primary: #1e3a5f;
      --accent: #00ffff;
      --accent-rgb: 0, 255, 255;
      --bg: #0a0f1a;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --panel: rgba(255, 255, 255, 0.04);
      --border: rgba(255, 255, 255, 0.10);
      --font: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", system-ui, sans-serif;
      
      /* Theme colors - will be changed by JS */
      --theme-bg: #0a0f1a;
      --theme-accent: 0, 255, 255;
      --theme-glow1: rgba(0, 255, 255, 0.12);
      --theme-glow2: rgba(30, 58, 95, 0.20);
    }

    /* Theme definitions */
    [data-theme="space"] {
      --theme-bg: #0a0f1a;
      --theme-accent: 0, 255, 255;
      --theme-glow1: rgba(0, 255, 255, 0.12);
      --theme-glow2: rgba(30, 58, 95, 0.20);
    }
    [data-theme="winter"] {
      --theme-bg: #0a1628;
      --theme-accent: 150, 220, 255;
      --theme-glow1: rgba(100, 200, 255, 0.15);
      --theme-glow2: rgba(180, 230, 255, 0.12);
    }
    [data-theme="nature"] {
      --theme-bg: #0a1a0f;
      --theme-accent: 100, 255, 150;
      --theme-glow1: rgba(80, 200, 120, 0.15);
      --theme-glow2: rgba(50, 150, 80, 0.12);
    }
    [data-theme="water"] {
      --theme-bg: #0a1420;
      --theme-accent: 80, 180, 255;
      --theme-glow1: rgba(60, 150, 255, 0.15);
      --theme-glow2: rgba(30, 100, 180, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--font);
      background: var(--theme-bg);
      color: var(--text);
      padding: 0;
      overflow: hidden;
      transition: background 2s ease;
    }
    
    /* Animated background layer */
    .bg-layer {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      transition: opacity 2s ease;
    }
    
    .bg-layer.fade-out { opacity: 0; }
    
    /* Space theme background */
    .bg-space {
      background: 
        radial-gradient(1200px 700px at 15% 20%, rgba(0, 255, 255, 0.12), transparent 55%),
        radial-gradient(1100px 650px at 90% 85%, rgba(30, 58, 95, 0.20), transparent 60%);
    }
    .bg-space::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 30% 50%, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 50% 30%, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 70% 70%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 20% 80%, rgba(0,255,255,0.5), transparent),
        radial-gradient(1px 1px at 80% 10%, rgba(0,255,255,0.4), transparent);
      animation: twinkle 4s ease-in-out infinite;
    }
    
    /* Winter theme with Aurora Borealis */
    .bg-winter {
      background: 
        radial-gradient(ellipse 150% 100% at 50% 0%, rgba(100, 255, 200, 0.08), transparent 40%),
        radial-gradient(ellipse 120% 80% at 30% 10%, rgba(150, 220, 255, 0.12), transparent 50%),
        radial-gradient(ellipse 100% 60% at 70% 20%, rgba(200, 150, 255, 0.08), transparent 45%);
    }
    .bg-winter::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(3px 3px at 15% 25%, rgba(255,255,255,0.95), transparent),
        radial-gradient(2px 2px at 35% 45%, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 55% 15%, rgba(255,255,255,0.85), transparent),
        radial-gradient(3px 3px at 75% 55%, rgba(255,255,255,0.75), transparent),
        radial-gradient(2px 2px at 25% 75%, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 85% 35%, rgba(255,255,255,0.7), transparent),
        radial-gradient(3px 3px at 45% 85%, rgba(255,255,255,0.8), transparent);
      animation: snowfall 8s linear infinite;
    }
    .bg-winter::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60%;
      background: 
        linear-gradient(180deg, 
          rgba(100, 255, 180, 0.15) 0%,
          rgba(100, 200, 255, 0.1) 30%,
          rgba(180, 100, 255, 0.08) 60%,
          transparent 100%);
      animation: aurora 12s ease-in-out infinite;
      filter: blur(30px);
    }
    
    @keyframes aurora {
      0%, 100% { 
        transform: translateX(-5%) scaleY(1); 
        opacity: 0.6;
      }
      25% { 
        transform: translateX(5%) scaleY(1.2); 
        opacity: 0.8;
      }
      50% { 
        transform: translateX(-3%) scaleY(0.9); 
        opacity: 0.5;
      }
      75% { 
        transform: translateX(3%) scaleY(1.1); 
        opacity: 0.7;
      }
    }
    
    @keyframes snowfall-static {
      0% { transform: translateY(0) rotate(0deg); }
      100% { transform: translateY(20px) rotate(5deg); }
    }
    
    /* Animated particles container */
    .particles-container {
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }
    
    /* Snowflakes for Winter theme */
    .snowflake {
      position: absolute;
      top: -5%;
      color: rgba(255, 255, 255, 0.9);
      font-size: 1em;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
      animation: snowfall-anim linear infinite;
      opacity: 0;
    }
    @keyframes snowfall-anim {
      0% {
        transform: translateY(0) translateX(0) rotate(0deg);
        opacity: 0;
      }
      5% { opacity: 0.9; }
      25% { transform: translateY(27vh) translateX(14px) rotate(90deg); }
      50% { transform: translateY(58vh) translateX(-10px) rotate(180deg); }
      75% { transform: translateY(85vh) translateX(10px) rotate(270deg); }
      95% { opacity: 0.9; }
      100% {
        transform: translateY(110vh) translateX(30px) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Leaves for Nature theme */
    .leaf {
      position: absolute;
      top: -5%;
      font-size: 1.2em;
      animation: leaffall-anim ease-in-out infinite;
      opacity: 0;
    }
    @keyframes leaffall-anim {
      0% {
        transform: translateY(0) translateX(0) rotate(0deg);
        opacity: 0;
      }
      5% { opacity: 0.85; }
      25% { transform: translateY(27vh) translateX(40px) rotate(90deg); }
      50% { transform: translateY(55vh) translateX(-20px) rotate(180deg); }
      75% { transform: translateY(82vh) translateX(30px) rotate(270deg); }
      95% { opacity: 0.7; }
      100% {
        transform: translateY(110vh) translateX(10px) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Bubbles for Water theme */
    .bubble {
      position: absolute;
      bottom: -10%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, 
        rgba(255, 255, 255, 0.9), 
        rgba(150, 220, 255, 0.4) 50%,
        rgba(100, 180, 255, 0.2));
      box-shadow: inset 0 -2px 4px rgba(0, 100, 200, 0.2),
                  0 0 8px rgba(150, 220, 255, 0.3);
      animation: bubble-rise ease-in infinite;
      opacity: 0;
    }
    @keyframes bubble-rise {
      0% {
        transform: translateY(0) translateX(0) scale(0.5);
        opacity: 0;
      }
      10% { opacity: 0.7; transform: scale(0.8); }
      50% { transform: translateY(-55vh) translateX(15px) scale(1); }
      90% { opacity: 0.5; }
      100% {
        transform: translateY(-115vh) translateX(-10px) scale(1.1);
        opacity: 0;
      }
    }
    
    /* Nature theme */
    .bg-nature {
      background: 
        radial-gradient(1200px 700px at 20% 30%, rgba(80, 200, 120, 0.15), transparent 55%),
        radial-gradient(1000px 600px at 80% 70%, rgba(50, 150, 80, 0.12), transparent 50%);
    }
    .bg-nature::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(3px 3px at 20% 30%, rgba(150, 255, 100, 0.6), transparent),
        radial-gradient(2px 2px at 40% 60%, rgba(100, 255, 150, 0.5), transparent),
        radial-gradient(3px 3px at 60% 25%, rgba(200, 255, 100, 0.4), transparent),
        radial-gradient(2px 2px at 80% 70%, rgba(150, 255, 120, 0.5), transparent),
        radial-gradient(2px 2px at 15% 80%, rgba(100, 255, 180, 0.4), transparent),
        radial-gradient(3px 3px at 70% 40%, rgba(180, 255, 100, 0.3), transparent);
      animation: fireflies 6s ease-in-out infinite;
    }
    
    @keyframes fireflies {
      0%, 100% { opacity: 0.4; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }
    
    /* Water theme */
    .bg-water {
      background: 
        radial-gradient(ellipse 120% 80% at 30% 70%, rgba(60, 150, 255, 0.15), transparent 50%),
        radial-gradient(ellipse 100% 60% at 70% 30%, rgba(30, 100, 180, 0.12), transparent 45%);
    }
    .bg-water::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(4px 4px at 25% 80%, rgba(150, 220, 255, 0.7), transparent),
        radial-gradient(3px 3px at 45% 70%, rgba(100, 200, 255, 0.6), transparent),
        radial-gradient(5px 5px at 65% 85%, rgba(120, 210, 255, 0.5), transparent),
        radial-gradient(3px 3px at 35% 60%, rgba(140, 220, 255, 0.6), transparent),
        radial-gradient(4px 4px at 75% 75%, rgba(100, 180, 255, 0.5), transparent),
        radial-gradient(3px 3px at 55% 90%, rgba(130, 200, 255, 0.4), transparent);
      animation: bubbles 10s ease-in-out infinite;
    }
    .bg-water::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40%;
      background: 
        linear-gradient(0deg,
          rgba(60, 150, 255, 0.1) 0%,
          transparent 100%);
      animation: waves 8s ease-in-out infinite;
    }
    
    @keyframes bubbles {
      0%, 100% { transform: translateY(0); opacity: 0.5; }
      50% { transform: translateY(-15px); opacity: 0.8; }
    }
    
    @keyframes waves {
      0%, 100% { transform: scaleY(1) translateY(0); }
      50% { transform: scaleY(1.1) translateY(-5px); }
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.4; }
    }
    
    /* Theme switch button in top bar */
    .theme-switch-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      color: var(--text);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: var(--font);
    }
    .theme-switch-btn:hover {
      background: rgba(0,0,0,0.6);
      border-color: rgba(var(--theme-accent), 0.4);
      transform: scale(1.02);
    }
    .theme-switch-btn svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
      transition: transform 0.3s ease;
    }
    .theme-switch-btn:hover svg {
      transform: rotate(30deg);
    }
    .theme-name {
      opacity: 0.9;
    }

    .fit-stage {
      position: fixed;
      inset: 0;
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Short viewports (e.g., phone landscape): avoid vertical centering.
       Keep aspect-ratio so the card doesn't collapse (its content is absolutely positioned). */
    @media (max-height: 520px) {
      .fit-stage { padding: 12px; }
      .card {
        margin: 0 auto;
        width: min(100%, calc((100dvh - 24px) * 1.75));
      }
    }

    .card {
      /* Fill viewport while keeping aspect ratio */
      width: min(calc((100dvh - 24px) * 1.75), calc(100vw - 24px));
      height: min(calc((100vw - 24px) / 1.75), calc(100dvh - 24px));
      max-width: 1050px;
      max-height: 600px;
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 2px solid rgba(var(--accent-rgb), 0.22);
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.06) inset,
        0 0 40px rgba(var(--accent-rgb), 0.10),
        0 0 90px rgba(var(--accent-rgb), 0.08);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .fit-content {
      position: absolute;
      inset: 0;
      transform: scale(var(--contentScale, 1));
      transform-origin: center;
      will-change: transform;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 20% 20%, rgba(var(--accent-rgb), 0.14), transparent 55%),
        radial-gradient(circle at 80% 70%, rgba(30,58,95,0.18), transparent 55%);
      filter: blur(18px);
      pointer-events: none;
    }



    .inner {
      position: absolute;
      inset: 26px;
      display: grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 22px;
      align-items: stretch;
      z-index: 1;
    }

    .left {
      display: grid;
      align-items: center;
    }

    .right {
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: 8px 6px 8px 0;
    }

    .brand {
      font-weight: 900;
      letter-spacing: 0.06em;
      font-size: clamp(20px, 2.4vw, 36px);
      margin-top: 2px;
      background: linear-gradient(135deg, var(--text), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sub {
      margin-top: 6px;
      color: var(--muted);
      font-size: clamp(12px, 1.2vw, 16px);
    }

    .divider {
      height: 2px;
      background: linear-gradient(90deg, rgba(var(--accent-rgb), 0.40), rgba(var(--accent-rgb), 0.05));
      margin: 14px 0 18px;
      border-radius: 999px;
    }

    .people {
      display: grid;
      gap: 16px;
      align-content: start;
    }

    .person .name {
      font-weight: 800;
      font-size: clamp(14px, 1.5vw, 22px);
      margin: 0;
    }

    .person .title {
      margin: 4px 0 0;
      color: rgba(148, 163, 184, 0.95);
      font-size: clamp(11px, 1.15vw, 15px);
    }

    .person .phone {
      margin: 5px 0 0;
      color: var(--accent);
      font-weight: 700;
      font-size: clamp(12px, 1.15vw, 16px);
    }

    .person .phone a {
      color: inherit;
      text-decoration: none;
    }

    .person .phone a:hover,
    .person .phone a:active {
      text-decoration: underline;
    }

    .footer {
      color: rgba(148, 163, 184, 0.9);
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .build {
      color: rgba(148, 163, 184, 0.75);
      font-size: 5.5px; /* 50% pienempi */
      white-space: nowrap;
    }

    .footer a {
      color: var(--accent);
      text-decoration: none;
      border: 1px solid rgba(var(--accent-rgb), 0.28);
      background: rgba(var(--accent-rgb), 0.08);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 12px;
    }

    .footer button {
      color: var(--accent);
      border: 1px solid rgba(var(--accent-rgb), 0.28);
      background: rgba(var(--accent-rgb), 0.08);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      font-family: var(--font);
    }

    .brand-link { text-decoration: none; display: inline-block; }

    .footer a:hover { background: rgba(var(--accent-rgb), 0.13); }
    .footer button:hover { background: rgba(var(--accent-rgb), 0.13); }

    .footer-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
    }

    .footer-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }

    .share-label {
      color: rgba(148, 163, 184, 0.9);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: 0.02em;
      margin-right: 2px;
    }

    .lang {
      color: rgba(241,245,249,0.85);
      border: 1px solid rgba(var(--accent-rgb), 0.20);
      background: rgba(0,0,0,0.22);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 12px;
      outline: none;
    }

    .lang.top {
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 11px;
    }

    .lang option { background: #0a0f1a; }

    html[dir="rtl"] body { direction: rtl; }
    html[dir="rtl"] .right { text-align: right; padding: 8px 0 8px 6px; }
    html[dir="rtl"] .footer { flex-direction: row-reverse; }
    html[dir="rtl"] .people { text-align: right; }
    html[dir="rtl"] .person .phone { direction: ltr; unicode-bidi: plaintext; }

    /* Browser mock */
    .browser {
      height: 100%;
      border-radius: 18px;
      background: rgba(8, 12, 20, 0.62);
      border: 1px solid rgba(var(--accent-rgb), 0.18);
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.06) inset,
        0 0 30px rgba(var(--accent-rgb), 0.10);
      overflow: hidden;
      position: relative;
    }

    .browser::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,0.06), transparent 62%);
      transform: translateX(-65%);
      opacity: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.85;
    }



    .topbar {
      height: 46px;
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .dots { display: flex; gap: 7px; }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.12) inset;
    }

    .addr {
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(var(--accent-rgb), 0.20);
      background: rgba(0,0,0,0.22);
      display: flex;
      align-items: center;
      padding: 0 10px;
      color: rgba(241,245,249,0.85);
      font-weight: 700;
      font-size: 12px;
      letter-spacing: 0.02em;
      overflow: hidden;
      position: relative;
    }

    .addr::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(var(--accent-rgb), 0.12) 50%, transparent 100%);
      transform: translateX(-100%);
      opacity: 0;
    }

    @keyframes addrGlow {
      0%, 50% { transform: translateX(-120%); opacity: 0; }
      65% { opacity: 1; }
      100% { transform: translateX(120%); opacity: 0; }
    }

    .viewport {
      height: calc(100% - 46px);
      background: #000;
      position: relative;
      padding: 12px;
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 12px;
    }

    .preview {
      min-height: 0;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(var(--accent-rgb), 0.15);
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      background: #000;
      position: relative;
    }

    .preview iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: #000;
      display: block;
    }

    .preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .preview.show-fallback iframe { display: none; }
    .preview.show-fallback img { display: block; }

    .open-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .open-site {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      border: 1px solid rgba(var(--accent-rgb), 0.28);
      background: rgba(var(--accent-rgb), 0.08);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 13px;
      cursor: pointer;
      font-family: var(--font);
      letter-spacing: 0.01em;
      text-decoration: none;
      white-space: nowrap;
    }

    .open-site:hover { background: rgba(var(--accent-rgb), 0.13); }

    .open-hint {
      font-size: 11px;
      color: rgba(241,245,249,0.72);
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      padding: 6px 9px;
      backdrop-filter: blur(6px);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .orientation-tip { display: none !important; }

    /* Mobile hero: animated space background + logo (shown only on mobile) */
    .left .mobile-hero {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      border-radius: 18px;
      background: var(--bg);
      border: 1px solid rgba(var(--accent-rgb), 0.18);
      position: relative;
      overflow: visible;
      min-height: 280px;
      height: 100%;
      padding: 20px;
    }

    .mobile-hero::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 18px;
      overflow: hidden;
      background:
        radial-gradient(ellipse 120% 80% at 30% 20%, rgba(var(--accent-rgb), 0.18), transparent 50%),
        radial-gradient(ellipse 100% 70% at 75% 80%, rgba(30, 58, 95, 0.25), transparent 50%);
      animation: heroPulse 8s ease-in-out infinite;
    }

    @keyframes heroPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }

    /* Animated stars */
    .left .mobile-hero .stars {
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 40% 70%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 60% 20%, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 80% 50%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1.5px 1.5px at 90% 10%, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 50% 90%, rgba(255,255,255,0.5), transparent),
        radial-gradient(2px 2px at 30% 50%, rgba(var(--accent-rgb), 0.6), transparent),
        radial-gradient(1.5px 1.5px at 70% 35%, rgba(var(--accent-rgb), 0.5), transparent);
      background-size: 100% 100%;
      animation: starsTwinkle 4s ease-in-out infinite;
    }

    @keyframes starsTwinkle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .left .mobile-hero .hero-logo {
      position: relative;
      z-index: 1;
      font-weight: 900;
      letter-spacing: 0.06em;
      font-size: clamp(28px, 9vw, 48px);
      background: linear-gradient(135deg, var(--text), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px rgba(var(--accent-rgb), 0.4);
      animation: logoGlow 3s ease-in-out infinite;
    }

    .left .mobile-hero .hero-icon {
      position: relative;
      z-index: 1;
      width: clamp(188px, 55vw, 313px); /* 25% isompi */
      height: auto;
      filter: drop-shadow(0 0 30px rgba(var(--accent-rgb), 0.6));
      animation: logoGlow 3s ease-in-out infinite;
      margin-top: clamp(47px, 14vw, 78px); /* 1/4 logon verran alaspäin */
    }

    @keyframes logoGlow {
      0%, 100% { filter: drop-shadow(0 0 20px rgba(var(--accent-rgb), 0.3)); }
      50% { filter: drop-shadow(0 0 35px rgba(var(--accent-rgb), 0.5)); }
    }

    .left .mobile-hero .hero-btn {
      position: relative;
      z-index: 10;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--accent);
      border: 2px solid rgba(var(--accent-rgb), 0.4);
      background: rgba(var(--accent-rgb), 0.1);
      padding: 14px 28px;
      border-radius: 16px;
      font-weight: 800;
      font-size: 15px;
      text-decoration: none;
      font-family: var(--font);
      letter-spacing: 0.02em;
      transition: all 0.3s ease;
      box-shadow: 0 0 30px rgba(var(--accent-rgb), 0.15);
      pointer-events: auto;
      cursor: pointer;
    }

    .left .mobile-hero .hero-btn:hover,
    .left .mobile-hero .hero-btn:active {
      background: rgba(var(--accent-rgb), 0.2);
      border-color: rgba(var(--accent-rgb), 0.6);
      box-shadow: 0 0 40px rgba(var(--accent-rgb), 0.25);
      transform: scale(1.02);
    }

    .left .mobile-hero .hero-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    /* Narrow screens: stack content vertically */
    @media (max-width: 720px) {
      .fit-stage { padding: 12px; }
      
      .card {
        aspect-ratio: auto;
        width: calc(100vw - 24px);
        height: auto;
        min-height: calc(100dvh - 24px);
        max-width: none;
        max-height: none;
        border-radius: 20px;
      }
      
      .inner {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        gap: 14px;
        inset: 12px;
      }
      
      /* Hide browser, show mobile hero */
      .left .browser { display: none !important; }
      .left .mobile-hero { display: flex !important; }
      
      /* Portrait: logo pienempi margin, CODESPHERE ylemmäksi, nappi pienempi */
      .left .mobile-hero .hero-icon { 
        margin-top: clamp(10px, 4vw, 30px); /* 1/4 logoa alaspäin */
      }
      .left .mobile-hero .hero-logo { 
        margin-top: -20px; /* CODESPHERE lähelle logoa */
        margin-bottom: 0;
      }
      .left .mobile-hero .hero-btn {
        padding: 10px 20px; /* Pienempi nappi */
        font-size: 13px;
        border-radius: 12px;
        gap: 6px;
        margin-top: -25px; /* Nappi ylemmäksi vihreälle alueelle */
      }
      .left .mobile-hero .hero-btn svg {
        width: 14px;
        height: 14px;
      }
      
      .left { min-height: 200px; }
      .right { padding: 0 !important; gap: 6px !important; }
      
      .brand { font-size: clamp(15px, 3vw, 20px) !important; }
      .sub { font-size: clamp(8px, 2vw, 10px) !important; }
      
      .person .name { font-size: clamp(10px, 2.4vw, 13px) !important; }
      .person .title { font-size: clamp(7px, 2vw, 9px) !important; }
      .person .phone { font-size: clamp(8px, 2vw, 10px) !important; }
      
      .people { gap: 6px !important; }
      
      .footer { 
        flex-direction: column; 
        align-items: flex-start; 
        gap: 10px;
        font-size: 10.5px;
      }
      
      .footer-actions { 
        width: 100%;
        align-items: flex-start; 
        gap: 8px;
      }
      
      .footer-row { 
        width: 100%;
        justify-content: flex-start; 
        gap: 8px;
      }
      
      .footer a, .footer button { 
        padding: 9px 11px; 
        font-size: 12px;
        flex: 0 1 auto;
      }
      
      .browser { border-radius: 14px; }
      .topbar { height: 40px; padding: 8px 10px; }
      .dots { gap: 5px; }
      .dot { width: 8px; height: 8px; }
      .addr { font-size: 11px; padding: 0 8px; height: 24px; }
      .viewport { height: calc(100% - 40px); }
    }

    /* Wider mobiles / small tablets: keep two columns (no orientation dependency) */
    @media (min-width: 721px) and (max-width: 900px) {
      .fit-stage { padding: 10px; }
      
      /* Show mobile hero instead of browser on tablets */
      .left .browser { display: none !important; }
      .left .mobile-hero { display: flex !important; }
      
      .card {
        aspect-ratio: auto;
        border-radius: 18px;
        min-height: 85vh;
        min-height: 85dvh;
        width: min(920px, 92vw);
        margin: 0 auto;
      }
      .inner {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr;
        gap: 12px;
        inset: 12px;
      }
      .left { min-height: 220px; }
      .right { padding: 0 6px; gap: 9px; }
      .brand { font-size: clamp(20px, 2.8vw, 26px); }
      .sub { font-size: clamp(11px, 2.2vw, 13px); }
      .people { gap: 8px; }
      .person .name { font-size: clamp(14px, 2.2vw, 18px); }
      .person .title { font-size: clamp(10px, 2vw, 13px); }
      .person .phone { font-size: clamp(11px, 2.1vw, 14px); }
      .footer { font-size: 10px; gap: 6px; }
      .footer a, .footer button { padding: 7px 9px; font-size: 11px; }
      .topbar { height: 38px; padding: 8px 10px; }
      .addr { font-size: 11px; height: 24px; padding: 0 8px; }
      .viewport { height: calc(100% - 38px); }
    }

    /* Mid landscape (900-1280px width) */
    @media (min-width: 901px) and (max-width: 1280px) and (orientation: landscape) {
      .fit-stage { padding: 14px; }
      .card {
        width: clamp(760px, 90vw, 980px);
        margin: 0 auto;
        min-height: auto;
      }
      .inner {
        grid-template-columns: 1.05fr 0.95fr;
        grid-template-rows: 1fr;
        gap: 10px;
      }
      .left { min-height: 220px; }
      .right { padding: 0 6px; gap: 8px; }
      .brand { font-size: clamp(17px, 2vw, 24px); }
      .sub { font-size: clamp(11px, 1.8vw, 13px); }
      .people { gap: 8px; }
      .person .name { font-size: clamp(13px, 1.9vw, 17px); }
      .person .title { font-size: clamp(10px, 1.7vw, 12px); }
      .person .phone { font-size: clamp(11px, 1.8vw, 13px); }
      .footer { font-size: 10.5px; gap: 7px; }
      .footer a, .footer button { padding: 8px 9px; font-size: 11px; }
    }

    /* Force two columns even on small landscape widths */
    @media (max-width: 900px) and (orientation: landscape) {
      .fit-stage { padding: 10px; }
      
      /* Show mobile hero instead of browser */
      .left .browser { display: none !important; }
      .left .mobile-hero { display: flex !important; }
      
      .card {
        width: clamp(620px, 88vw, 900px);
        margin: 0 auto;
        min-height: auto;
      }
      .inner {
        grid-template-columns: 1.3fr 0.7fr; /* Logo isompi, kontaktit pienempi */
        grid-template-rows: 1fr;
        gap: 6px;
      }
      .left { min-height: 180px; }
      .right { padding: 0 4px; gap: 2px; }
      .brand { font-size: clamp(10px, 1.4vw, 14px) !important; }
      .sub { font-size: clamp(6px, 1vw, 8px) !important; }
      .people { gap: 2px; }
      .person { margin-bottom: 0; }
      .person .name { font-size: clamp(7px, 1.1vw, 10px) !important; }
      .person .title { font-size: clamp(5px, 0.9vw, 7px) !important; line-height: 1.15; }
      .person .phone { font-size: clamp(6px, 1vw, 8px) !important; }
      .footer { font-size: 9px; gap: 4px; display: none; }
      
      /* Hero isommaksi landscapessa */
      .left .mobile-hero .hero-icon { width: clamp(110px, 36vw, 200px); margin-top: clamp(-60px, -15vw, -100px); } /* Logo ylemmäksi */
      .left .mobile-hero .hero-logo { font-size: clamp(16px, 4.5vw, 28px); letter-spacing: 0.4em; margin-top: 0; } /* Teksti alaspäin vihreälle */
    }

    /* Final override for very short viewports (phone landscape):
       ensure the card keeps a real height (aspect-ratio must not become auto). */
    @media (max-height: 520px) {
      .card {
        aspect-ratio: 1050 / 600;
        width: min(100%, calc((100dvh - 24px) * 1.75));
        min-height: 0;
      }
    }

    /* Very short landscape: reduce inner insets so all contacts fit. */
    @media (max-height: 520px) and (orientation: landscape) {
      .fit-stage { 
        padding: 6px;
        align-items: flex-start;
        justify-content: center;
      }
      .card {
        height: calc(100dvh - 12px);
        width: auto;
        aspect-ratio: 1050 / 600;
        margin: 0 auto;
      }
      .inner { 
        inset: 5px; 
        gap: 5px;
        align-items: stretch;
        grid-template-columns: 1.3fr 0.7fr; /* Logo isompi, kontaktit pienempi */
      }
      .divider { margin: 2px 0 3px; height: 1px; }
      .right { 
        padding: 2px 3px; 
        gap: 0;
        grid-template-rows: auto 1fr auto;
        align-content: start;
        overflow: hidden;
      }
      header { margin-bottom: 0; }
      .brand { font-size: clamp(8px, 1.5vh, 11px); margin-top: 0; }
      .sub { font-size: clamp(5px, 0.9vh, 7px); margin-top: 0; }
      .people { gap: 0; align-content: start; }
      .person { margin-bottom: 0; }
      .person .name { font-size: clamp(6px, 1.2vh, 9px); margin: 0; }
      .person .title { font-size: clamp(4px, 0.85vh, 6px); margin: 0; line-height: 1.15; }
      .person .phone { font-size: clamp(5px, 0.95vh, 7px); margin: 0; }
      .footer { display: none; } /* Hide footer in landscape to fit content */
      
      /* Hero in landscape - centered, bigger logo, no button */
      .left { min-height: 0; }
      .left .mobile-hero { 
        gap: 4px; 
        min-height: 0; 
        padding: 6px;
        justify-content: center;
      }
      .left .mobile-hero .hero-icon { width: clamp(100px, 32vh, 170px); margin-top: clamp(-50px, -16vh, -85px); } /* Logo ylemmäksi */
      .left .mobile-hero .hero-logo { font-size: clamp(14px, 4vh, 22px); letter-spacing: 0.4em; margin-top: 0; } /* Teksti alaspäin vihreälle */
      .left .mobile-hero .hero-btn { display: none; } /* Hide button in tight landscape */
    }
  </style>
</head>
<body data-theme="space">
  <!-- Animated background layers -->
  <div class="bg-layer bg-space" id="bgSpace"></div>
  <div class="bg-layer bg-winter fade-out" id="bgWinter"></div>
  <div class="bg-layer bg-nature fade-out" id="bgNature"></div>
  <div class="bg-layer bg-water fade-out" id="bgWater"></div>
  
  <!-- Theme switch button -->
  <button class="theme-switch-btn" id="themeSwitchBtn" title="Vaihda taustateema">
    <svg viewBox="0 0 24 24"><path d="M12 4V2M12 22v-2M6.34 6.34L4.93 4.93M19.07 19.07l-1.41-1.41M4 12H2M22 12h-2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41M12 17a5 5 0 100-10 5 5 0 000 10z"/></svg>
    <span class="theme-name" id="themeName">Avaruus</span>
  </button>
  
  <div class="fit-stage" id="fitStage">
    <main class="card" role="img" aria-label="Codesphere digitaalinen käyntikortti">
      <div class="fit-content" id="fitContent">
        <div class="orientation-tip" id="orientationTip">Paras kokemus vaakana</div>
        <div class="inner">
        <section class="left">
          <!-- Desktop/Tablet: Browser mock -->
          <div class="browser" aria-label="Selaimen esikatselu: Codesphere-sivusto">
            <div class="topbar">
              <div class="dots" aria-hidden="true">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
              </div>
              <div class="addr"><span>toeksy.github.io</span><span style="opacity:.7">/codesphere-website_1</span></div>
              <select class="lang top" id="langTop" aria-label="Language"></select>
            </div>
            <div class="viewport">
            <div class="preview" aria-label="Staattinen esikatselu">
                  <img src="../social/og.png" alt="Codesphere esikatselu" />
                  <iframe id="sitePreview" title="Codesphere sivuston esikatselu" loading="lazy" src="../../index.html?v=2025-12-19-v6"></iframe>
                </div>
                <div class="open-row">
                  <a class="open-site" href="https://toeksy.github.io/codesphere-website_1/" target="_blank" rel="noopener">Avaa sivusto</a>
                  <span class="open-hint">Staattinen esikatselu (mobiiliystävällinen)</span>
                </div>
            </div>
          </div>

          <!-- Mobile: Animated space hero -->
          <div class="mobile-hero" aria-label="Codesphere">
            <div class="stars"></div>
            <img class="hero-icon" src="../logo/codesphere-logo-512-transparent.png" alt="Codesphere logo" />
            <div class="hero-logo">CODESPHERE</div>
            <a class="hero-btn" href="https://toeksy.github.io/codesphere-website_1/" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
              <span data-i18n="openSite">Avaa sivusto</span>
            </a>
          </div>
        </section>

        <section class="right">
          <header>
            <a class="brand brand-link" href="https://toeksy.github.io/codesphere-website_1/" target="_blank" rel="noopener">CODESPHERE</a>
            <div class="sub" data-i18n="subtitle">Yhteystiedot</div>
            <div class="divider"></div>
          </header>

          <div class="people">
            <div class="person">
              <p class="name">Timo Aula</p>
              <p class="title" data-i18n="timoTitle">Toimitusjohtaja, Böethius Oy • Ohjelmistokehityksen asiantuntija</p>
              <p class="phone"><a href="tel:+358457977313">puh +358 45 7977 3133</a></p>
            </div>
            <div class="person">
              <p class="name">Matti Erholtz</p>
              <p class="title" data-i18n="mattiTitle">Hallituksen jäsen • Markkinointijohtaja &amp; Tekoälyarkkitehti</p>
              <p class="phone"><a href="tel:+358409132714">puh +358 40 913 2714</a></p>
            </div>
            <div class="person">
              <p class="name">Mika Leppänen</p>
              <p class="title" data-i18n="mikaTitle">Kyberturvallisuusasiantuntija • Asiantuntijatodistelu (tuomioistuimet)</p>
              <p class="phone"><a href="tel:+358465581732">puh +358 46 558 1732</a></p>
            </div>
          </div>

          <div class="footer">
            <div data-i18n="tagline">codesphere | globaalia ohjelmistokehitystä</div>
            <div class="build" id="buildTag" aria-label="Build"></div>
            <div class="footer-actions">
              <div class="footer-row">
                <select class="lang" id="lang" aria-label="Language"></select>
                <a href="contacts.vcf" download data-i18n="downloadVcard">vCard</a>
                <a href="business-card.png" target="_blank" rel="noopener" data-i18n="openPng">Avaa PNG-käyntikortti</a>
              </div>
              <div class="footer-row" aria-label="Share">
                <span class="share-label" data-i18n="shareLabel">Jaa</span>
                <a id="shareWhatsApp" href="#" target="_blank" rel="noopener" data-i18n="shareWhatsApp">WhatsApp</a>
                <a id="shareFacebook" href="#" target="_blank" rel="noopener" data-i18n="shareFacebook">Facebook</a>
                <button id="shareSignal" type="button" data-i18n="shareSignal">Signal</button>
                <button id="shareInstagram" type="button" data-i18n="shareInstagram">Instagram</button>
              </div>
            </div>
          </div>
        </section>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Minimal i18n: auto language via ?lang=xx or navigator.language, with localStorage.
    const SUPPORTED = [
      { code: 'fi', label: 'Suomi' },
      { code: 'en', label: 'English' },
      { code: 'sv', label: 'Svenska' },
      { code: 'no', label: 'Norsk' },
      { code: 'da', label: 'Dansk' },
      { code: 'is', label: 'Íslenska' },
      { code: 'de', label: 'Deutsch' },
      { code: 'es', label: 'Español' },
      { code: 'ar', label: 'العربية' },
    ];

    const I18N = {
      fi: {
        title: 'Codesphere – Digitaalinen käyntikortti',
        subtitle: 'Yhteystiedot',
        tagline: 'codesphere | globaalia ohjelmistokehitystä',
        downloadVcard: 'vCard',
        openPng: 'Avaa PNG-käyntikortti',
        openSite: 'Avaa sivusto',
        shareLabel: 'Jaa',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Linkki kopioitu',
        phonePrefix: 'puh',
        timoTitle: 'Toimitusjohtaja, Böethius Oy • Ohjelmistokehityksen asiantuntija',
        mattiTitle: 'Hallituksen jäsen • Markkinointijohtaja & Tekoälyarkkitehti',
        mikaTitle: 'Kyberturvallisuusasiantuntija • Asiantuntijatodistelu (tuomioistuimet)',
      },
      en: {
        title: 'Codesphere – Digital business card',
        subtitle: 'Contact',
        tagline: 'codesphere | global software development',
        downloadVcard: 'vCard',
        openPng: 'Open PNG card',
        openSite: 'Open website',
        shareLabel: 'Share',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Link copied',
        phonePrefix: 'tel',
        timoTitle: 'CEO, Böethius Oy • Software development specialist',
        mattiTitle: 'Board member • Marketing Director & AI Architect',
        mikaTitle: 'Cybersecurity specialist • Expert testimony (courts)',
      },
      sv: {
        title: 'Codesphere – Digitalt visitkort',
        subtitle: 'Kontakt',
        tagline: 'codesphere | global mjukvaruutveckling',
        downloadVcard: 'vCard',
        openPng: 'Öppna PNG-kort',
        openSite: 'Öppna webbplats',
        shareLabel: 'Dela',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Länk kopierad',
        phonePrefix: 'tel',
        timoTitle: 'VD, Böethius Oy • Expert inom mjukvaruutveckling',
        mattiTitle: 'Styrelseledamot • Marknadschef & AI-arkitekt',
        mikaTitle: 'Cybersäkerhetsexpert • Sakkunnigutlåtanden (domstolar)',
      },
      no: {
        title: 'Codesphere – Digitalt visittkort',
        subtitle: 'Kontakt',
        tagline: 'codesphere | global programvareutvikling',
        downloadVcard: 'vCard',
        openPng: 'Åpne PNG-kort',
        openSite: 'Åpne nettsted',
        shareLabel: 'Del',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Lenke kopiert',
        phonePrefix: 'tlf',
        timoTitle: 'Daglig leder, Böethius Oy • Ekspert på programvareutvikling',
        mattiTitle: 'Styremedlem • Markedsdirektør & AI-arkitekt',
        mikaTitle: 'Cybersikkerhetsekspert • Sakkyndig vitnemål (domstoler)',
      },
      da: {
        title: 'Codesphere – Digitalt visitkort',
        subtitle: 'Kontakt',
        tagline: 'codesphere | global softwareudvikling',
        downloadVcard: 'vCard',
        openPng: 'Åbn PNG-kort',
        openSite: 'Åbn hjemmeside',
        shareLabel: 'Del',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Link kopieret',
        phonePrefix: 'tlf',
        timoTitle: 'Direktør, Böethius Oy • Ekspert i softwareudvikling',
        mattiTitle: 'Bestyrelsesmedlem • Marketingdirektør & AI-arkitekt',
        mikaTitle: 'Cybersikkerhedsekspert • Sagkyndig vidneudsagn (domstole)',
      },
      is: {
        title: 'Codesphere – Stafrænt nafnspjald',
        subtitle: 'Samskipti',
        tagline: 'codesphere | alþjóðleg hugbúnaðarþróun',
        downloadVcard: 'vCard',
        openPng: 'Opna PNG spjald',
        openSite: 'Opna vefsíðu',
        shareLabel: 'Deila',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Tengill afritaður',
        phonePrefix: 'sími',
        timoTitle: 'Forstjóri, Böethius Oy • Sérfræðingur í hugbúnaðarþróun',
        mattiTitle: 'Stjórnarmaður • Markaðsstjóri & AI-arkitekt',
        mikaTitle: 'Netöryggissérfræðingur • Sérfróð vitnisburður (dómstólar)',
      },
      de: {
        title: 'Codesphere – Digitale Visitenkarte',
        subtitle: 'Kontakt',
        tagline: 'codesphere | globale Softwareentwicklung',
        downloadVcard: 'vCard',
        openPng: 'PNG-Karte öffnen',
        openSite: 'Website öffnen',
        shareLabel: 'Teilen',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Link kopiert',
        phonePrefix: 'tel',
        timoTitle: 'Geschäftsführer, Böethius Oy • Experte für Softwareentwicklung',
        mattiTitle: 'Vorstandsmitglied • Marketing Director & KI-Architekt',
        mikaTitle: 'Cybersicherheits-Experte • Sachverständigengutachten (Gerichte)',
      },
      es: {
        title: 'Codesphere – Tarjeta digital',
        subtitle: 'Contacto',
        tagline: 'codesphere | desarrollo de software global',
        downloadVcard: 'vCard',
        openPng: 'Abrir tarjeta PNG',
        openSite: 'Abrir sitio web',
        shareLabel: 'Compartir',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'Enlace copiado',
        phonePrefix: 'tel',
        timoTitle: 'CEO, Böethius Oy • Especialista en desarrollo de software',
        mattiTitle: 'Miembro del consejo • Director de Marketing y Arquitecto de IA',
        mikaTitle: 'Especialista en ciberseguridad • Testimonio pericial (tribunales)',
      },
      ar: {
        title: 'Codesphere – بطاقة عمل رقمية',
        subtitle: 'معلومات التواصل',
        tagline: 'codesphere | تطوير برمجيات عالمي',
        downloadVcard: 'vCard',
        openPng: 'فتح بطاقة PNG',
        openSite: 'فتح الموقع',
        shareLabel: 'مشاركة',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareSignal: 'Signal',
        shareInstagram: 'Instagram',
        shareCopied: 'تم نسخ الرابط',
        phonePrefix: 'هاتف',
        timoTitle: 'المدير التنفيذي، Böethius Oy • مختص بتطوير البرمجيات',
        mattiTitle: 'عضو مجلس الإدارة • مدير التسويق ومهندس معمارية ذكاء اصطناعي',
        mikaTitle: 'مختص أمن سيبراني • شهادة خبير (المحاكم)',
      },
    };

    function normalizeLang(raw) {
      if (!raw) return 'fi';
      const lc = String(raw).toLowerCase();
      const base = lc.split('-')[0];
      return I18N[base] ? base : 'fi';
    }

    function getLangFromUrl() {
      const params = new URLSearchParams(location.search);
      const l = params.get('lang');
      return l ? normalizeLang(l) : null;
    }

    function setUrlLang(lang) {
      try {
        const url = new URL(location.href);
        url.searchParams.set('lang', lang);
        history.replaceState({}, '', url.toString());
      } catch {}
    }

    function shareUrlForLang(lang) {
      try {
        const url = new URL(location.href);
        url.searchParams.set('lang', lang);
        return url.toString();
      } catch {
        return location.href;
      }
    }

    function updateShareLinks(lang) {
      const t = I18N[lang] || I18N.fi;
      const shareUrl = shareUrlForLang(lang);
      const text = `Codesphere: ${shareUrl}`;

      const wa = document.getElementById('shareWhatsApp');
      if (wa) wa.href = `https://wa.me/?text=${encodeURIComponent(text)}`;

      const fb = document.getElementById('shareFacebook');
      if (fb) fb.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;

      const signalBtn = document.getElementById('shareSignal');
      if (signalBtn) {
        signalBtn.onclick = async () => {
          if (navigator.share) {
            try {
              await navigator.share({ title: t.title, text, url: shareUrl });
              return;
            } catch {}
          }

          // Fallback: try deep link; if blocked/not installed, copy URL.
          try {
            location.href = `signal://send?text=${encodeURIComponent(text)}`;
            return;
          } catch {}

          try {
            await navigator.clipboard.writeText(shareUrl);
            alert(t.shareCopied);
          } catch {
            prompt(t.shareCopied, shareUrl);
          }
        };
      }

      const igBtn = document.getElementById('shareInstagram');
      if (igBtn) {
        igBtn.onclick = async () => {
          if (navigator.share) {
            try {
              await navigator.share({ title: t.title, text, url: shareUrl });
              return;
            } catch {}
          }
          // Instagram ei tue luotettavaa web-linkkijakoa desktopissa → kopioi linkki.
          try {
            await navigator.clipboard.writeText(shareUrl);
            alert(t.shareCopied);
          } catch {
            prompt(t.shareCopied, shareUrl);
          }
        };
      }
    }

    function applyLang(lang) {
      const t = I18N[lang] || I18N.fi;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.title = t.title;

      document.querySelectorAll('[data-i18n]').forEach((el) => {
        const key = el.getAttribute('data-i18n');
        if (!key) return;
        const value = t[key];
        if (typeof value === 'string') el.textContent = value;
      });

      document.querySelectorAll('.phone[data-phone]').forEach((el) => {
        const num = el.getAttribute('data-phone') || '';
        el.textContent = `${t.phonePrefix} ${num}`.trim();
      });

      try { localStorage.setItem('codesphere_lang', lang); } catch {}

      const sel = document.getElementById('lang');
      if (sel) sel.value = lang;
      const selTop = document.getElementById('langTop');
      if (selTop) selTop.value = lang;

      setUrlLang(lang);
      updateShareLinks(lang);
      window.requestFitCard && window.requestFitCard();
    }

    function initLangUI() {
      const sels = [document.getElementById('lang'), document.getElementById('langTop')].filter(Boolean);
      for (const s of sels) {
        const sel = s;
        sel.innerHTML = '';
        for (const opt of SUPPORTED) {
          const o = document.createElement('option');
          o.value = opt.code;
          o.textContent = opt.label;
          sel.appendChild(o);
        }
        sel.addEventListener('change', () => applyLang(normalizeLang(sel.value)));
      }
    }

    function pickInitialLang() {
      const fromUrl = getLangFromUrl();
      if (fromUrl) return fromUrl;
      try {
        const saved = localStorage.getItem('codesphere_lang');
        if (saved) return normalizeLang(saved);
      } catch {}
      return normalizeLang(navigator.language || 'fi');
    }

    const buildTag = document.getElementById('buildTag');
    const params = new URLSearchParams(location.search);
    const metaV = document.querySelector('meta[name="version"]')?.getAttribute('content');
    const v = params.get('v') || metaV || 'main';
    if (buildTag) buildTag.textContent = `build ${v}`;

    initLangUI();
    applyLang(pickInitialLang());

    // Live preview on all devices: force iframe src and hide fallback image.
    const sitePreview = document.getElementById('sitePreview');
    const previewBox = sitePreview?.closest('.preview');
    if (sitePreview && previewBox) {
      const base = sitePreview.getAttribute('data-base') || sitePreview.getAttribute('src') || '../../index.html';
      sitePreview.src = `${base.split('?')[0]}?v=${encodeURIComponent(v)}&r=${Date.now()}`;
      previewBox.classList.remove('show-fallback');
      sitePreview.addEventListener('error', () => previewBox.classList.add('show-fallback'));
      sitePreview.addEventListener('load', () => previewBox.classList.remove('show-fallback'));
    }

    // Fit-to-viewport: scale the entire card (including browser mock + contacts) to fill viewport.
    const BASE_W = 1050;
    const BASE_H = 600;
    const fitStage = document.getElementById('fitStage');
    const card = document.querySelector('.card');
    const fitContent = document.getElementById('fitContent');
    const rightCol = document.querySelector('.right');
    const inner = document.querySelector('.inner');
    let fitRaf = 0;

    function stageContentBox() {
      if (!fitStage) return { w: 0, h: 0 };
      const cs = getComputedStyle(fitStage);
      const padX = (parseFloat(cs.paddingLeft) || 0) + (parseFloat(cs.paddingRight) || 0);
      const padY = (parseFloat(cs.paddingTop) || 0) + (parseFloat(cs.paddingBottom) || 0);
      const vp = window.visualViewport;
      const w = Math.max(0, (vp ? vp.width : fitStage.clientWidth) - padX);
      const h = Math.max(0, (vp ? vp.height : fitStage.clientHeight) - padY);
      return { w, h };
    }

    function isFixedAspectRatio() {
      if (!card) return false;
      const ar = getComputedStyle(card).aspectRatio;
      return !!ar && ar !== 'auto' && ar !== '0 / 0';
    }

    function fitNow() {
      fitRaf = 0;
      if (!fitStage || !card) return;

      // CSS handles scaling via width/height with dvh/vw units.
      // This function just triggers reflow if needed and can be used for future enhancements.
      const vp = window.visualViewport;
      if (vp) {
        // Update CSS custom properties for mobile keyboard etc.
        document.documentElement.style.setProperty('--vp-height', vp.height + 'px');
      }
    }

    function requestFit() {
      if (fitRaf) return;
      fitRaf = requestAnimationFrame(() => requestAnimationFrame(fitNow));
    }

    window.requestFitCard = requestFit;

    requestFit();
    window.addEventListener('resize', requestFit, { passive: true });
    window.addEventListener('orientationchange', requestFit, { passive: true });
    try {
      window.visualViewport && window.visualViewport.addEventListener('resize', requestFit, { passive: true });
      window.visualViewport && window.visualViewport.addEventListener('scroll', requestFit, { passive: true });
    } catch {}
    try {
      new ResizeObserver(requestFit).observe(fitStage);
      new ResizeObserver(requestFit).observe(card);
    } catch {}
    try { document.fonts && document.fonts.ready && document.fonts.ready.then(requestFit); } catch {}
  </script>
  
  <!-- Particles container -->
  <div class="particles-container" id="particlesContainer"></div>
  
  <!-- Theme rotation script -->
  <script>
    (function() {
      const themes = ['space', 'winter', 'nature', 'water'];
      const themeNames = {
        space: 'Avaruus',
        winter: 'Talvi',
        nature: 'Luonto',
        water: 'Vesi'
      };
      const bgLayers = {
        space: document.getElementById('bgSpace'),
        winter: document.getElementById('bgWinter'),
        nature: document.getElementById('bgNature'),
        water: document.getElementById('bgWater')
      };
      const particlesContainer = document.getElementById('particlesContainer');
      const switchBtn = document.getElementById('themeSwitchBtn');
      const themeNameEl = document.getElementById('themeName');
      let currentIndex = 0;
      let autoRotateInterval;
      let particleIntervals = [];
      
      // Particle configurations
      const snowflakes = ['❄', '❅', '❆', '✻', '✼', '❉'];
      const leaves = ['🍂', '🍁', '🍃', '🌿'];
      
      function clearParticles() {
        particleIntervals.forEach(clearInterval);
        particleIntervals = [];
        if (particlesContainer) {
          particlesContainer.innerHTML = '';
        }
      }
      
      function createSnowflake() {
        const el = document.createElement('div');
        el.className = 'snowflake';
        el.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
        el.style.left = Math.random() * 100 + '%';
        el.style.fontSize = (0.5 + Math.random() * 0.6) + 'em';
        el.style.animationDuration = (12 + Math.random() * 8) + 's';
        el.style.animationDelay = Math.random() * 2 + 's';
        particlesContainer.appendChild(el);
        setTimeout(() => el.remove(), 26000);
      }
      
      function createLeaf() {
        const el = document.createElement('div');
        el.className = 'leaf';
        el.textContent = leaves[Math.floor(Math.random() * leaves.length)];
        el.style.left = Math.random() * 100 + '%';
        el.style.fontSize = (0.65 + Math.random() * 0.45) + 'em';
        el.style.animationDuration = (10 + Math.random() * 8) + 's';
        el.style.animationDelay = Math.random() * 2 + 's';
        particlesContainer.appendChild(el);
        setTimeout(() => el.remove(), 20000);
      }
      
      function createBubble() {
        const el = document.createElement('div');
        el.className = 'bubble';
        const size = 5 + Math.random() * 10;
        el.style.width = size + 'px';
        el.style.height = size + 'px';
        el.style.left = Math.random() * 100 + '%';
        el.style.animationDuration = (8 + Math.random() * 6) + 's';
        el.style.animationDelay = Math.random() * 2 + 's';
        particlesContainer.appendChild(el);
        setTimeout(() => el.remove(), 16000);
      }
      
      function startParticles(theme) {
        clearParticles();
        if (!particlesContainer) return;
        
        switch(theme) {
          case 'winter':
            // Create initial batch of snowflakes
            for (let i = 0; i < 4; i++) {
              setTimeout(createSnowflake, i * 150);
            }
            // Continue creating snowflakes
            particleIntervals.push(setInterval(createSnowflake, 2300));
            break;
            
          case 'nature':
            // Create initial batch of leaves
            for (let i = 0; i < 3; i++) {
              setTimeout(createLeaf, i * 200);
            }
            // Continue creating leaves
            particleIntervals.push(setInterval(createLeaf, 3400));
            break;
            
          case 'water':
            // Create initial batch of bubbles
            for (let i = 0; i < 3; i++) {
              setTimeout(createBubble, i * 180);
            }
            // Continue creating bubbles
            particleIntervals.push(setInterval(createBubble, 2600));
            break;
            
          default:
            // Space theme - no additional particles (stars are in CSS)
            break;
        }
      }
      
      // Load saved theme
      const savedTheme = localStorage.getItem('codesphere-theme');
      if (savedTheme && themes.includes(savedTheme)) {
        currentIndex = themes.indexOf(savedTheme);
      }
      
      function setTheme(themeName, save = true) {
        // Update body data-theme
        document.body.setAttribute('data-theme', themeName);
        
        // Fade out all backgrounds, fade in current
        themes.forEach(t => {
          if (bgLayers[t]) {
            bgLayers[t].classList.toggle('fade-out', t !== themeName);
          }
        });
        
        // Start theme-specific particles
        startParticles(themeName);
        
        // Update button text
        if (themeNameEl) {
          themeNameEl.textContent = themeNames[themeName] || themeName;
        }
        
        // Save preference
        if (save) {
          localStorage.setItem('codesphere-theme', themeName);
        }
        
        currentIndex = themes.indexOf(themeName);
      }
      
      function nextTheme() {
        currentIndex = (currentIndex + 1) % themes.length;
        setTheme(themes[currentIndex]);
      }
      
      function startAutoRotate() {
        stopAutoRotate();
        autoRotateInterval = setInterval(nextTheme, 30000); // 30 seconds
      }
      
      function stopAutoRotate() {
        if (autoRotateInterval) {
          clearInterval(autoRotateInterval);
        }
      }
      
      // Click button to change theme
      if (switchBtn) {
        switchBtn.addEventListener('click', () => {
          nextTheme();
          startAutoRotate(); // Reset timer after manual change
        });
      }
      
      // Initialize
      setTheme(themes[currentIndex], false);
      startAutoRotate();
      
      // Pause rotation when tab is hidden
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          stopAutoRotate();
          clearParticles();
        } else {
          startAutoRotate();
          startParticles(themes[currentIndex]);
        }
      });
    })();
  </script>
</body>
</html>
